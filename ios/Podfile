# 这里的版本号必须与 Codemagic 里的 Deployment Target 一致，建议 13.0
platform :ios, '13.0'

# 解决 Ruby 3.3+ 兼容性问题
class File; class << self; alias_method :exists?, :exist?; end; end

target 'Runner' do
  use_frameworks!
  use_modular_headers!

  flutter_install_all_ios_pods File.dirname(File.realpath(__FILE__))
end

post_install do |installer|
  installer.pods_project.targets.each do |target|
    flutter_additional_ios_build_settings(target)

    # 强制所有插件使用相同的 iOS 部署版本，避免版本冲突
    target.build_configurations.each do |config|
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '13.0'
      # 修复新版 Xcode 可能会遇到的签名问题
      config.build_settings['ENABLE_BITCODE'] = 'NO'
    end
  end
end